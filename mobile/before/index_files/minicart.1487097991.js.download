function Minicart(a){this.formKey=a.formKey,this.previousVal=null,this.defaultErrorMessage="Error occurred. Try to refresh page.",this.selectors={itemRemove:"#cart-sidebar .remove",container:"#header-cart",inputQty:".cart-item-quantity",qty:"div.header-minicart span.count",overlay:".minicart-wrapper",error:"#minicart-error-message",success:"#minicart-success-message",quantityButtonPrefix:"#qbutton-",quantityInputPrefix:"#qinput-",quantityButtonClass:".quantity-button"},a.selectors&&$j.extend(this.selectors,a.selectors)}Minicart.prototype={initAfterEvents:{},removeItemAfterEvents:{},init:function(){var a=this;$j(this.selectors.itemRemove).unbind("click.minicart").bind("click.minicart",function(b){b.preventDefault(),a.removeItem($j(this))}),$j(this.selectors.inputQty).unbind("blur.minicart").unbind("focus.minicart").bind("focus.minicart",function(){a.previousVal=$j(this).val(),a.displayQuantityButton($j(this))}).bind("blur.minicart",function(){a.revertInvalidValue(this)}),$j(this.selectors.quantityButtonClass).unbind("click.quantity").bind("click.quantity",function(){a.processUpdateQuantity(this)});for(var b in this.initAfterEvents)this.initAfterEvents.hasOwnProperty(b)&&"function"==typeof this.initAfterEvents[b]&&this.initAfterEvents[b]()},removeItem:function(a){var b=this;confirm(a.data("confirm"))&&(b.hideMessage(),b.showOverlay(),$j.ajax({type:"POST",dataType:"json",data:{form_key:b.formKey},url:a.attr("href")}).done(function(c){b.hideOverlay(),c.success?(b.updateCartQty(c.qty),b.updateContentOnRemove(c,a.closest("li"))):b.showMessage(c)}).error(function(){b.hideOverlay(),b.showError(b.defaultErrorMessage)}));for(var c in this.removeItemAfterEvents)this.removeItemAfterEvents.hasOwnProperty(c)&&"function"==typeof this.removeItemAfterEvents[c]&&this.removeItemAfterEvents[c]()},revertInvalidValue:function(a){this.isValidQty($j(a).val())&&$j(a).val()!=this.previousVal||($j(a).val(this.previousVal),this.hideQuantityButton(a))},displayQuantityButton:function(a){var b=this.selectors.quantityButtonPrefix+$j(a).data("item-id");$j(b).addClass("visible").attr("disabled",null)},hideQuantityButton:function(a){var b=this.selectors.quantityButtonPrefix+$j(a).data("item-id");$j(b).removeClass("visible").attr("disabled","disabled")},processUpdateQuantity:function(a){var b=$j(this.selectors.quantityInputPrefix+$j(a).data("item-id"));this.isValidQty(b.val())&&b.val()!=this.previousVal?this.updateItem(a):this.revertInvalidValue(b)},updateItem:function(a){var b=this,c=$j(this.selectors.quantityInputPrefix+$j(a).data("item-id")),d=parseInt(c.val(),10);return b.hideMessage(),b.showOverlay(),$j.ajax({type:"POST",dataType:"json",url:c.data("link"),data:{qty:d,form_key:b.formKey}}).done(function(a){b.hideOverlay(),a.success?(b.updateCartQty(a.qty),0!==d?b.updateContentOnUpdate(a):b.updateContentOnRemove(a,c.closest("li"))):b.showMessage(a)}).error(function(){b.hideOverlay(),b.showError(b.defaultErrorMessage)}),!1},updateContentOnRemove:function(a,b){var c=this;b.hide("slow",function(){$j(c.selectors.container).html(a.content),c.showMessage(a)})},updateContentOnUpdate:function(a){$j(this.selectors.container).html(a.content),this.showMessage(a)},updateCartQty:function(a){"undefined"!=typeof a&&$j(this.selectors.qty).text(a)},isValidQty:function(a){return a.length>0&&a-0==a&&a-0>0},showOverlay:function(){$j(this.selectors.overlay).addClass("loading")},hideOverlay:function(){$j(this.selectors.overlay).removeClass("loading")},showMessage:function(a){"undefined"!=typeof a.notice?this.showError(a.notice):"undefined"!=typeof a.error?this.showError(a.error):"undefined"!=typeof a.message&&this.showSuccess(a.message)},hideMessage:function(){$j(this.selectors.error).fadeOut("slow"),$j(this.selectors.success).fadeOut("slow")},showError:function(a){$j(this.selectors.error).text(a).fadeIn("slow")},showSuccess:function(a){$j(this.selectors.success).text(a).fadeIn("slow")}};