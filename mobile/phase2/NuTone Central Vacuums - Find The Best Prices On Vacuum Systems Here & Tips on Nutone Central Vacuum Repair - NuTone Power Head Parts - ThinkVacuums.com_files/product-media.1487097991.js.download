var ConfigurableMediaImages={imageType:null,productImages:{},imageObjects:{},arrayIntersect:function(a,b){for(var c=0,d=0,e=new Array;c<a.length&&d<b.length;)a[c]<b[d]?c++:a[c]>b[d]?d++:(e.push(a[c]),c++,d++);return e},getCompatibleProductImages:function(a,b){var c=[],d=[];return b.each(function(b){if(a.option_labels[b]){var e=a.option_labels[b].products;d.push(e),e.each(function(a){c.push(a)})}}),d.each(function(a){c=ConfigurableMediaImages.arrayIntersect(c,a)}),c},isValidImage:function(a){return!!a},getSwatchImage:function(a,b,c){var d=ConfigurableMediaImages.productImages[a];if(!d)return null;var e=d.option_labels[b];if(e&&d.option_labels[b].configurable_product[ConfigurableMediaImages.imageType])return d.option_labels[b].configurable_product[ConfigurableMediaImages.imageType];var f=ConfigurableMediaImages.getCompatibleProductImages(d,c);if(0==f.length)return null;$j.each(d.option_labels,function(a,b){var c=b.configurable_product[ConfigurableMediaImages.imageType],d=b.products;if(c){var e=ConfigurableMediaImages.arrayIntersect(d,f).length>0;if(e)return c}});var g=null,h=d[ConfigurableMediaImages.imageType];return f.each(function(a){if(h[a]&&ConfigurableMediaImages.isValidImage(h[a]))return g=h[a],!1}),g?g:h[a]&&ConfigurableMediaImages.isValidImage(h[a])?h[a]:null},getImageObject:function(a,b){var c=a+"-"+b;if(!ConfigurableMediaImages.imageObjects[c]){var d=$j("<img />");d.attr("src",b),ConfigurableMediaImages.imageObjects[c]=d}return ConfigurableMediaImages.imageObjects[c]},updateImage:function(a){var b=$j(a),c=b.find("option:selected").attr("data-label"),d=optionsPrice.productId,e=new Array;$j(".product-options .super-attribute-select").each(function(){var a=$j(this);""!=a.val()&&e.push(a.find("option:selected").attr("data-label"))});var f=ConfigurableMediaImages.getSwatchImage(d,c,e);if(ConfigurableMediaImages.isValidImage(f)){var g=ConfigurableMediaImages.getImageObject(d,f);ProductMediaManager.swapImage(g)}},wireOptions:function(){$j(".product-options .super-attribute-select").change(function(a){ConfigurableMediaImages.updateImage(this)})},swapListImage:function(a,b){var c=$j("#product-collection-image-"+a);if(b[0].complete)c.addClass("hidden"),$j(".product-collection-image-"+a).remove(),b.insertAfter(c);else{var d=c.parent();d.addClass("loading"),imagesLoaded(b,function(){d.removeClass("loading"),c.addClass("hidden"),$j(".product-collection-image-"+a).remove(),b.insertAfter(c)})}},swapListImageByOption:function(a,b){var c=ConfigurableMediaImages.getSwatchImage(a,b,[b]);if(c){var d=ConfigurableMediaImages.getImageObject(a,c);d.addClass("product-collection-image-"+a),ConfigurableMediaImages.swapListImage(a,d)}},setImageFallback:function(a,b){ConfigurableMediaImages.productImages[a]=b},init:function(a){ConfigurableMediaImages.imageType=a,ConfigurableMediaImages.wireOptions()}};